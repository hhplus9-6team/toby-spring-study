# 1.8 XML을 이용한 설정

스프링은 자바 클래스를 이용한 설정 외에도 **XML을 이용한 설정**을 지원한다.
XML은 단순한 텍스트 파일이므로 컴파일과 같은 별도의 빌드 작업 없이 설정 정보를 변경할 수 있다는 장점이 있다.

## 1.8.1 XML 설정

스프링 애플리케이션 컨텍스트는 XML에 담긴 DI 정보를 활용할 수 있다.

### 빈(Bean) 설정 비교

| 자바 코드 설정 | XML 설정 |
|---|---|
| `@Configuration` | `<beans>` |
| `@Bean methodName()` | `<bean id="methodName"` |
| `return new BeanClass();` | `class="a.b.c.BeanClass">` |

### `<beans>`를 루트 엘리먼트로 사용
- `<beans>` 안에는 여러 개의 `<bean>`을 정의할 수 있다.
- `@Configuration`을 `<beans>`, `@Bean`을 `<bean>`에 대응된다고 생각하면 이해하기 쉽다.

### connectionMaker() 전환

#### 자바 코드
```java
@Bean
public ConnectionMaker connectionMaker() {
    return new DConnectionMaker();
}
```

#### XML 설정
```xml
<bean id="connectionMaker" class="springbook.user.dao.DConnectionMaker" />
```

### userDao() 전환

#### 자바 코드
```java
@Bean
public UserDao userDao() {
    UserDao userDao = new UserDao();
    userDao.setConnectionMaker(connectionMaker());
    return userDao;
}
```

#### XML 설정
```xml
<bean id="userDao" class="springbook.user.dao.UserDao">
    <property name="connectionMaker" ref="connectionMaker" />
</bean>
```

### `<property>` 태그
- **name**: 프로퍼티의 이름 (수정자 메서드에서 set을 제외한 나머지 부분)
- **ref**: 주입할 빈의 id

> [!NOTE]
> #### property와 ref 속성
> - `name="connectionMaker"` → `setConnectionMaker()` 메서드를 호출한다는 의미
> - `ref="connectionMaker"` → `connectionMaker`라는 id를 가진 빈을 주입한다는 의미
> - 같은 이름을 사용했지만, name은 수정자 메서드를 의미하고 ref는 빈의 id를 의미한다.

### XML의 의존관계 주입 정보

#### 완성된 XML 설정 파일 (applicationContext.xml)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="connectionMaker" class="springbook.user.dao.DConnectionMaker" />

    <bean id="userDao" class="springbook.user.dao.UserDao">
        <property name="connectionMaker" ref="connectionMaker" />
    </bean>

</beans>
```

## 1.8.2 XML을 이용하는 애플리케이션 컨텍스트

XML 설정 파일을 사용하려면 `GenericXmlApplicationContext`를 사용한다.

```java
ApplicationContext context =
    new GenericXmlApplicationContext("applicationContext.xml");
```

### 애플리케이션 컨텍스트 종류
| 클래스 | 설명 |
|---|---|
| `GenericXmlApplicationContext` | XML 설정 파일을 사용 |
| `ClassPathXmlApplicationContext` | 클래스패스에서 XML 파일을 찾아 사용 |
| `AnnotationConfigApplicationContext` | 자바 코드(@Configuration) 설정을 사용 |

## 1.8.3 DataSource 인터페이스로 변환

### DataSource 인터페이스 적용
- `ConnectionMaker`는 DB 커넥션을 생성해주는 기능 하나만 정의한 매우 단순한 인터페이스
- 자바에서는 이미 DB 커넥션을 가져오는 오브젝트의 기능을 추상화한 `DataSource` 인터페이스가 존재
- 실전에서는 `ConnectionMaker` 같은 인터페이스를 직접 만들어 사용할 일은 거의 없다

```java
public interface DataSource extends CommonDataSource, Wrapper {
    Connection getConnection() throws SQLException;
    // ...
}
```

#### UserDao 리팩토링

```java
public class UserDao {
    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public void add(User user) throws SQLException {
        Connection c = dataSource.getConnection();
        // ...
    }
}
```

### 자바 코드 설정 방식

```java
@Bean
public DataSource dataSource() {
    SimpleDriverDataSource dataSource = new SimpleDriverDataSource();

    dataSource.setDriverClass(com.mysql.jdbc.Driver.class);
    dataSource.setUrl("jdbc:mysql://localhost/springbook");
    dataSource.setUsername("spring");
    dataSource.setPassword("book");

    return dataSource;
}

@Bean
public UserDao userDao() {
    UserDao userDao = new UserDao();
    userDao.setDataSource(dataSource());
    return userDao;
}
```

### XML 설정 방식

```xml
<bean id="dataSource"
      class="org.springframework.jdbc.datasource.SimpleDriverDataSource" />

<bean id="userDao" class="springbook.user.dao.UserDao">
    <property name="dataSource" ref="dataSource" />
</bean>
```

## 1.8.4 프로퍼티 값의 주입

### 값 주입
다른 빈 오브젝트의 레퍼런스가 아니라 **단순 값을 주입**할 경우 `value` 속성을 사용한다.

```xml
<bean id="dataSource"
      class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
    <property name="driverClass" value="com.mysql.jdbc.Driver" />
    <property name="url" value="jdbc:mysql://localhost/springbook" />
    <property name="username" value="spring" />
    <property name="password" value="book" />
</bean>
```

### value 값의 자동 변환

> [!NOTE]
> #### value 속성의 타입 변환
> - `value` 속성에 넣는 값은 모두 **문자열**이다.
> - 스프링이 프로퍼티의 타입을 참고하여 적절한 형태로 **자동 변환**해준다.
> - 예: `"com.mysql.jdbc.Driver"` 문자열 → `Class` 타입 객체로 변환

### 최종 XML 설정 파일

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="dataSource"
          class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
        <property name="driverClass" value="com.mysql.jdbc.Driver" />
        <property name="url" value="jdbc:mysql://localhost/springbook" />
        <property name="username" value="spring" />
        <property name="password" value="book" />
    </bean>

    <bean id="userDao" class="springbook.user.dao.UserDao">
        <property name="dataSource" ref="dataSource" />
    </bean>

</beans>
```

## 정리

| 구분 | 자바 코드 설정 | XML 설정 |
|---|---|---|
| 설정 클래스/파일 | `@Configuration` 클래스 | `applicationContext.xml` |
| 빈 등록 | `@Bean` 메서드 | `<bean>` 태그 |
| 의존관계 주입 (빈) | 메서드 호출 | `<property ref="">` |
| 의존관계 주입 (값) | setter 호출 | `<property value="">` |
| 장점 | 타입 안전성, IDE 지원 | 컴파일 없이 변경 가능 |

## 질문
- XML 설정 vs 자바 코드 설정의 장단점을 각각 2가지 이상 설명하라.
- 현재 스프링부트 프로젝트에서 XML 설정을 거의 사용하지 않는 이유는?

---

## 참고: 스프링부트에서는?

> [!NOTE]  
> 현재 스프링부트에서는 XML 설정을 거의 사용하지 않고, 자바 기반 설정과 자동 설정(Auto Configuration)을 사용한다.

### 스프링부트의 설정 방식

| 방식 | 설명 |
|---|---|
| `@Configuration` + `@Bean` | 자바 코드로 빈 등록 |
| `@Component`, `@Service`, `@Repository` | 컴포넌트 스캔으로 자동 등록 |
| `application.properties` / `application.yml` | DB 연결 정보, 포트 등 외부 설정 |
| **Auto Configuration** | 스프링부트가 의존성을 보고 자동으로 설정 |

### DataSource 설정 비교

#### XML 방식 (스프링 3.x)
```xml
<bean id="dataSource"
      class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
    <property name="driverClass" value="com.mysql.jdbc.Driver" />
    <property name="url" value="jdbc:mysql://localhost/springbook" />
    <property name="username" value="spring" />
    <property name="password" value="book" />
</bean>
```

#### 스프링부트 방식 (application.properties)
```properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost/springbook
spring.datasource.username=spring
spring.datasource.password=book
```

#### 스프링부트 방식 (application.yml)
```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost/springbook
    username: spring
    password: book
```

### 왜 XML을 사용하지 않는가?

| XML 설정의 단점 | 자바/스프링부트 설정의 장점 |
|---|---|
| 오타를 컴파일 시점에 발견 불가 | 타입 안전성 (컴파일 시점 오류 발견) |
| IDE 자동완성 제한적 | IDE 지원 (자동완성, 리팩토링) |
| 설정이 길어지면 가독성 저하 | 간결한 설정 |
| 별도 파일 관리 필요 | 코드와 설정의 일관성 |

## 스프링 vs 스프링부트 설정 동작 비교

### 순수 스프링       
```java
    // 1. XML 설정 파일 직접 작성                                                                                                                                                                          
    // 2. 컨테이너 직접 생성                                                                                                                                                                               
    ApplicationContext context =                                                                                                                                                                           
        new GenericXmlApplicationContext("applicationContext.xml");                                                                                                                                        
    // 3. 빈 직접 꺼내기                                                                                                                                                                                   
    UserDao dao = context.getBean("userDao", UserDao.class);
```

### 스프링부트
```java
    @SpringBootApplication                                                                                                                                                                                 
    public class MyApplication {                                                                                                                                                                           
        public static void main(String[] args) {                                                                                                                                                           
            SpringApplication.run(MyApplication.class, args);                                                                                                                   
        }                                                                                                                                                                                                  
    }
```

**스프링부트가 내부에서 하는 일**

1. @SpringBootApplication                                                                                                                                                                     
   - @Configuration - Java Config 클래스                                                                                                                                                                
   - @EnableAutoConfiguration - 자동 설정                                                                                                                                                               
   - @ComponentScan - 빈 자동 탐색
2. SpringApplication.run() 호출 시                                                                                                                                                                    
   컨테이너 생성 → 클래스패스 스캔 → @Component 찾음 → 빈 등록 → 의존성 주입 → 서버 시작
3. Auto Configuration                                                                                                                                                                                 
   - DB 드라이버 있으면 → DataSource 자동 생성                                                                                                                                                          
   - 웹 의존성 있으면 → 톰캣 자동 설정 
